<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心语晴窗 - 基于AI与东方智慧的高中生心理支持平台</title>
    <!-- 引入 Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide Icons for modern icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="../static/css/all.css">
    <link rel="stylesheet" href="../static/css/loginsignup.css">
    <style>
        /* 设置全局字体，使用 Inter 作为现代无衬线字体 */
        .chat-bubble-user {
            background-color: #d1fae5; /* Green 100 */
            border-bottom-right-radius: 0;
        }
        .chat-bubble-ai {
            background-color: #e0f2fe; /* Blue 100 */
            border-bottom-left-radius: 0;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #14b8a6;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .new_Function
        {
            height:200px;
            background-color:red;
        }
	@media screen and (max-width:768px){
		.feback{
			margin-left: 20px; 
			display: flex;
			align-items: center;
		}
	}
    </style>
</head>
<body class="text-gray-800 antialiased">

    <!-- 导航栏 (Header) -->
    <header>
        <!-- 将 max-w-8xl 改为 max-w-7xl (tailwind 常用最大宽度) 保证一致性，并保留 mx-auto 居中 -->
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="feback">
                <img src="../static/images/xinyuqingchuang.jpg" class="h-7" alt="logo">
                <h1 class="text-2xl font-bold text-teal-600">心语晴窗</h1>
            </div>
            <nav class="hidden md:flex space-x-6 text-sm font-medium">
                <a href="/index" class="text-teal-600 font-semibold transition duration-300">ai对话</a>
                <a href="/guanhuai" class="hover:text-teal-600 transition duration-300">心理关怀工具</a>
                <!-- 当前页面高亮 -->
                <a href="/treel" class="hover:text-teal-600 transition duration-300">匿名树洞</a>
                <a href="/knowledge" class="hover:text-teal-600 transition duration-300">心理健康知识</a>
            </nav>
            <div class="flex items-center space-x-3">
                <button class="bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg shadow-lg transition duration-300 transform hover:scale-105" id='loginBtn'>
                    登录/注册
                </button>
                <span class="text-sm font-normal text-gray-500 border-l border-gray-300 pl-3">建议与反馈</span>
            </div>
        </div>
    </header>

    <!--登录模拟框-->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeLogin">&times;</span>
            <h2>登录</h2>
            <form id="loginForm">
                <label for="loginUsername">账号</label>
                <input type="text" id="loginUsername" name="username" placeholder="请输入账号" required>

                <label for="loginPassword">密码</label>
                <input type="password" id="loginPassword" name="password" placeholder="请输入密码" required>

                <div class="button-group">
                    <button type="button" class="login-btn" id="modalLoginBtn">登录</button>
                    <button type="button" class="register-btn" id="modalRegisterBtn">注册</button>
                </div>
            </form>
        </div>
    </div>



    <!--注册模拟框-->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeRegister">&times;</span>
            <h2>注册</h2>
            <form id="registerForm">
                <!-- 用户名 -->
                <label for="regUsername">用户名</label>
                <input type="text" id="regUsername" name="username" placeholder="请输入用户名" required>
                <div class="input-hint">2~10个字母</div>

                <!-- 密码 -->
                <label for="regPassword">密码</label>
                <input type="password" id="regPassword" name="password" placeholder="请输入密码" required>
                <div class="input-hint">6~16位英文或数字</div>

                <!-- 确认密码 -->
                <label for="regConfirmPassword">确认密码</label>
                <input type="password" id="regConfirmPassword" name="confirmPassword" placeholder="请再次输入密码" required>

                <!-- 按钮组 -->
                <div class="button-group">
                    <button type="button" class="register-btn" id="modalRegisterConfirmBtn">注册</button>
                </div>

                <!-- 返回登录链接 -->
                <div class="back-link">
                    <a id="backToLogin">← 返回登录</a>
                </div>
            </form>
        </div>
    </div>
    <script src="../static/js/loginsignup.js"></script>

    <!-- 英雄区 (Hero Section) -->
    <section class="py-16 md:py-24 text-center bg-white shadow-xl rounded-b-[40px] mb-12">
        <div class="max-w-4xl mx-auto px-6">
            <h2 class="text-5xl md:text-6xl font-extrabold text-teal-700 mb-4 leading-tight">
                AI心理支持专家系统
            </h2>
            <p class="text-xl md:text-2xl text-gray-600 mb-8">
                融合 <span class="font-bold text-teal-500">CBT、东方智慧、中医情志</span>，为高中生成长保驾护航。
            </p>
            <div class="space-y-4 md:space-y-0 md:space-x-4">
                <a href="#demo" class="inline-block bg-teal-500 hover:bg-teal-600 text-white text-lg font-bold py-3 px-8 rounded-xl shadow-2xl shadow-teal-300 transition duration-300 transform hover:scale-105">
                    立即体验 AI 赋能 ?
                </a>
                <a href="#" class="inline-block bg-white text-teal-500 border-2 border-teal-500 text-lg font-bold py-3 px-8 rounded-xl hover:bg-teal-50 transition duration-300 transform hover:shadow-lg">
                    了解我们的安全承诺
                </a>
            </div>
        </div>
    </section>

    <!-- 核心创新区 (Core Innovation) -->
    <section id="innovation" class="toolbox">
        <h3 class="toolh3">
            「三核」融合创新：超越通用AI
        </h3>
        <div class="toolcardbox">
            <!-- 创新点 1: CBT -->
            <div class="toolcard border-t-4 border-teal-500">
                <i data-lucide="brain" class="w-10 h-10 text-teal-500 mb-4"></i>
                <h4 class="text-2xl font-bold mb-2">认知行为疗法 (CBT)</h4>
                <p class="text-gray-600">科学主干，提供结构化的方法论，帮助用户识别并挑战"灾难化思维"等负面认知陷阱，将情绪困扰转化为可处理的"认知目标"。</p>
                <p class="mt-4 text-sm font-semibold text-teal-600">解决：负面思维模式</p>
            </div>
            <!-- 创新点 2: 中国古代哲学 -->
            <div class="toolcard border-t-4 border-yellow-500">
                <i data-lucide="scroll-text" class="w-10 h-10 text-yellow-500 mb-4"></i>
                <h4 class="text-2xl font-bold mb-2">中国古代哲学</h4>
                <p class="text-gray-600">引入儒家、道家、禅宗智慧，用于世界观的拓展与认知重构，从根本上解决"世界观太小"的问题，将失败定义为成长的水流。</p>
                <p class="mt-4 text-sm font-semibold text-yellow-600">解决：僵化世界观</p>
            </div>
            <!-- 创新点 3: 中医情志理论 -->
            <div class="toolcard border-t-4 border-red-500">
                <i data-lucide="heart-pulse" class="w-10 h-10 text-red-500 mb-4"></i>
                <h4 class="text-2xl font-bold mb-2">中医情志理论</h4>
                <p class="text-gray-600">提供"身心同治"方案，根据情绪影响脏腑的理论（如思伤脾），提供呼吸训练、音乐调理等具象化的身心调节技术，即时放松身体。</p>
                <p class="mt-4 text-sm font-semibold text-red-600">解决：身体的紧张和不适</p>
            </div>
        </div>
    </section>

    <!-- AI 赋能功能演示区 (Gemini API Demo) -->
    <section id="demo" class="max-w-4xl mx-auto px-6 py-12">
        <h3 class="text-4xl font-bold text-center mb-12 text-teal-700">
            AI 赋能：实时深度干预演示
        </h3>
        
        <div class="bg-white p-8 rounded-2xl shadow-2xl border border-teal-200 space-y-6">
            <p class="text-lg text-gray-600 font-medium">请输入你当前的心理困扰 (例如：我作业太多了，压力好大，感觉喘不过气。)</p>
            
            <!-- 1. 文本输入与生成 -->
            <div>
                <textarea id="user-input" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 resize-y min-h-[100px]" placeholder="请输入你的困扰..."></textarea>
                <button id="generate-guidance" class="w-full mt-4 bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition duration-300 transform hover:scale-[1.01] flex items-center justify-center disabled:opacity-50" disabled>
                    <i data-lucide="zap" class="w-5 h-5 mr-2"></i> 
                    ? 启动三核深度引导 (LLM)
                </button>
            </div>

            <!-- 2. 文本结果展示 -->
            <div id="guidance-output-container" class="mt-6 border border-teal-300 bg-teal-50 p-5 rounded-lg hidden">
                <h4 class="text-xl font-bold mb-3 text-teal-700 flex items-center">
                    <i data-lucide="sparkles" class="w-6 h-6 mr-2 text-teal-500"></i>
                    AI 伙伴的定制化指导：
                </h4>
                <div id="guidance-output" class="prose max-w-none text-gray-700 leading-relaxed space-y-4">
                    <!-- LLM Generated Content will be inserted here -->
                </div>
            </div>
            
            <!-- 3. TTS 语音生成与播放 -->
            <div class="pt-6 border-t border-gray-200">
                <p class="text-lg font-semibold text-gray-700 mb-3">身心调节音频演示 (中医情志介入):</p>
                <button id="generate-audio" class="w-full md:w-auto bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition duration-300 transform hover:scale-[1.01] flex items-center justify-center disabled:opacity-50" disabled>
                    <i data-lucide="volume-2" class="w-5 h-5 mr-2"></i> 
                    ? 生成安抚呼吸音频 (TTS)
                </button>
                <div id="audio-player-container" class="mt-4 hidden items-center space-x-3">
                    <audio id="audio-player" controls class="w-full md:w-2/3"></audio>
                    <span class="text-sm text-gray-500">(音频已生成，请播放)</span>
                </div>
            </div>

            <!-- 4. Loading Indicator -->
            <div id="loading-indicator" class="flex justify-center items-center space-x-3 mt-4 hidden">
                <div class="spinner"></div>
                <span class="text-teal-600 font-semibold">AI 正在进行深度分析与生成...</span>
            </div>

            <!-- 5. Error Message -->
            <div id="error-message" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg hidden" role="alert">
                <!-- Error messages will be inserted here -->
            </div>
        </div>
    </section>

    <!-- 专业干预流程示例 (Original User Experience) -->
    <section id="experience" class="max-w-7xl mx-auto px-6 py-12">
        <h3 class="text-4xl font-bold text-center mb-12 text-teal-700">
            专业干预流程示例 (三核融合演示)
        </h3>
        
        <div class="max-w-2xl mx-auto p-6 bg-white rounded-2xl shadow-2xl border border-gray-100">
            <!-- 对话容器 -->
            <div class="space-y-6">

                <!-- 用户输入 -->
                <div class="flex justify-end">
                    <div class="max-w-xs md:max-w-md p-4 rounded-xl chat-bubble-user text-gray-800 shadow-md">
                        "我这次月考考砸了，感觉人生没有希望了，一切都完了。"
                    </div>
                </div>

                <!-- AI - 第一步：CBT共情 + 锁定扭曲认知 -->
                <div class="flex justify-start">
                    <div class="max-w-xs md:max-w-md p-4 rounded-xl chat-bubble-ai text-gray-800 shadow-md">
                        <span class="font-bold text-teal-600 block mb-1">AI 伙伴 (CBT 介入)</span>
                        听到你这么说，我能感受到你深深的绝望和无助。当你说'一切都完了'的时候，我们能不能一起看一看这个念头？这似乎是一种叫<span class="font-semibold">'灾难化思维'</span>的认知陷阱。你愿意和我一起挑战一下这个想法吗？"
                    </div>
                </div>

                <!-- AI - 第二步：哲学视角引入 -- 重构"失败"的定义 -->
                <div class="flex justify-start">
                    <div class="max-w-xs md:max-w-md p-4 rounded-xl chat-bubble-ai text-gray-800 shadow-md border-l-4 border-yellow-500">
                        <span class="font-bold text-yellow-600 block mb-1">AI 伙伴 (哲学重构)</span>
                        我们不妨借一双中国古代智慧的眼睛来看待'失败'。庄子在《逍遥游》里说：'大舟也无力，小舟也无力，此乃无力之力也。'水的力量不在于硬碰硬，而在于它的包容和迂回。一次考试的失利，它是否可以像水流一样，将你推向另一个更适合你的方向？
                    </div>
                </div>

                <!-- AI - 第三步：CBT技术落实 + 自我探索 -->
                <div class="flex justify-start">
                    <div class="max-w-xs md:max-w-md p-4 rounded-xl chat-bubble-ai text-gray-800 shadow-md">
                        <span class="font-bold text-teal-600 block mb-1">AI 伙伴 (CBT 提问)</span>
                        现在，让我们做一个'思维实验'：
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li>支持'我的人生完了'这个想法的证据是什么？</li>
                            <li>反对这个想法的证据呢？</li>
                            <li>如果你最好的朋友经历了同样的事，你会对他/她说什么？</li>
                        </ul>
                    </div>
                </div>

                <!-- AI - 第四步：中医情志介入 -- 安抚身体 -->
                <div class="flex justify-start">
                    <div class="max-w-xs md:max-w-md p-4 rounded-xl chat-bubble-ai text-gray-800 shadow-md border-l-4 border-red-500">
                        <span class="font-bold text-red-600 block mb-1">AI 伙伴 (中医 情志调节)</span>
                        当我们陷入思虑时，身体会感到压力。根据中医理论，'思伤脾'。让我为你推荐一个简单易行的方法：<span class="font-semibold">'嘘'字诀呼吸法</span>。请轻轻地、缓慢地从嘴里发出'嘘--'的声音，同时想象将胸口的浊气全部吐出。我们一起来做三次，好吗？
                    </div>
                </div>

                <!-- AI - 第五步：整合与行动 -->
                <div class="flex justify-start">
                    <div class="max-w-xs md:max-w-md p-4 rounded-xl chat-bubble-ai text-gray-800 shadow-md">
                        <span class="font-bold text-teal-600 block mb-1">AI 伙伴 (总结与升华)</span>
                        你看，我们完成了一次了不起的'自我保卫战'！这次失利，不再是终点，而是你开始整合智慧、更全面认识自己的起点。我建议你将今天的感悟记录下来。
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 目标用户与承诺区 (Target Users & Commitment) -->
    <section id="users" class="max-w-7xl mx-auto px-6 py-12 bg-white rounded-xl shadow-xl mt-12 mb-16">
        <div class="grid md:grid-cols-2 gap-10 items-center">
            <div>
                <h3 class="text-3xl font-bold mb-4 text-teal-700">我们的服务对象与承诺</h3>
                <p class="text-lg text-gray-600 mb-6">
                    「心」以<span class="font-semibold text-teal-500">上海市高中生</span>为切入点，目标服务全国市场。我们理解青少年的独特挑战，提供专业、安全、且文化友好的支持。
                </p>
                <ul class="space-y-3 text-gray-700">
                    <li class="flex items-start">
                        <i data-lucide="lock" class="w-5 h-5 text-teal-500 mr-3 mt-1 flex-shrink-0"></i>
                        <span class="font-semibold">数据安全：</span>明确告知用户数据安全受保护，所有交互数据仅用于匿名化分析。
                    </li>
                    <li class="flex items-start">
                        <i data-lucide="users-round" class="w-5 h-5 text-teal-500 mr-3 mt-1 flex-shrink-0"></i>
                        <span class="font-semibold">多元包容：</span>数据与内容设计准确、全面，尊重所有学生的个体差异。
                    </li>
                    <li class="flex items-start">
                        <i data-lucide="git-branch" class="w-5 h-5 text-teal-500 mr-3 mt-1 flex-shrink-0"></i>
                        <span class="font-semibold">专业可控：</span>AI 引擎并非通用聊天接口，而是遵循<span class="text-teal-500">预设专业流程</span>，确保回答的专业性与一致性。
                    </li>
                </ul>
            </div>
            <div class="p-6 bg-gray-50 rounded-lg shadow-inner">
                <i data-lucide="message-square" class="w-8 h-8 text-teal-600 mb-3"></i>
                <p class="text-2xl font-bold text-gray-800">不是聊天机器人，是心理支持专家系统。</p>
                <p class="text-gray-500 mt-2">
                    我们提供的是一个遵循'认知识别-哲学重构-技术落实-身心调节'动态流程的智能引导系统。
                </p>
            </div>
        </div>
    </section>

    <!-- 底部 (Footer) -->
    <footer class="bg-gray-800 text-white p-8">
        <div class="max-w-7xl mx-auto text-center">
            <div class="mb-4">
                <h4 class="text-xl font-bold text-teal-400">心语晴窗</h4>
                <p class="text-sm text-gray-400">AI赋能，东方智慧，关注高中生成长。</p>
            </div>
            <div class="text-sm text-gray-500">
                &copy; 2025 心语晴窗项目组. 保留所有权利。
            </div>
        </div>
    </footer>

    <!-- 初始化 Lucide 图标 -->
    <script>
        lucide.createIcons();
    </script>
    
    <!-- Firebase/Auth Imports (Mandatory Setup) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // import { getFirestore, collection, ... } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app, auth;

        if (Object.keys(firebaseConfig).length > 0) {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            // db = getFirestore(app);

            // Authentication setup
            onAuthStateChanged(auth, async (user) => {
                if (!user) {
                    try {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                        console.log("Firebase Auth successful.");
                        document.getElementById('generate-guidance').disabled = false;
                        document.getElementById('generate-audio').disabled = false;

                    } catch (error) {
                        console.error("Firebase Auth failed:", error);
                        document.getElementById('error-message').textContent = `认证失败：${error.message}`;
                        document.getElementById('error-message').classList.remove('hidden');
                    }
                } else {
                    document.getElementById('generate-guidance').disabled = false;
                    document.getElementById('generate-audio').disabled = false;
                }
            });
        } else {
            // Assume Auth is ready if no config is provided (for local testing)
            document.getElementById('generate-guidance').disabled = false;
            document.getElementById('generate-audio').disabled = false;
        }
    </script>

    <!-- Gemini API Logic -->
    <script type="module">
        // --- Utility Functions ---

        // Helper function for Base64 to ArrayBuffer (for TTS)
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }
        </script>
    </body>

</html>
